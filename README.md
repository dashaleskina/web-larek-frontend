https://github.com/dashaleskina/web-larek-frontend.git

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

Проект "Веб-ларек" это платформа, которая показывает пример небольшого интернет магазина.

Что доступно пользователю? Фундамент - покупка уникальных инструментов для работы за вымышленную виртуальную валюту "синапсы".

1. Просмотр общего каталога товаров. Сами товары оформлены как карточки с основной необходимой информацией для покупателя.
2. Карточка товара. При клике на товар. пользователю открывается, помимо общей информации, еще и подробное описание товара, а также возможность добавить товар в корзину.
3. Корзина. Тут пользователь может просмотреть выбранные товары (название и стоимость), может удалить товар или перейти к оформлению заказа;
4. Форма оплаты и доставки. Тут все просто - покупатель выбирает способ оплаты и вбивает адрес. Без адреса и способа оплаты оформление товара невозможно
5. Форма с контактами. Пользователю необходимо внести электронную почту и номер телефона для оплаты. Переход к оплате возможен только при заполнении полей
6. Окно успешного заказа. Тут мы видим уведомление о том, что заказ успешно оформлен, а также сумму на которую были совершены покупки

Проект реализуется на TypeScript

## Типы данных

Товар

```
export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    basketStatus: boolean;
    price: number | null;
}
```

Инфо о заказе в корзине

```
export interface IOrderInfo {
    items: IProduct[];
    total: number | null;
    email: string;
    phone: string;
    payment: TPaymentProcess;
    address: string;
    formError: Partial<Record<keyof IOrderInfo, string>>;
    isValid: boolean;
}
```

Виды оплаты

```
export type TPaymentProcess = 'онлайн' | 'при получении';
```

Тип только с персональными данными:

```
export type TPersonalInfo = Pick<IOrderInfo, 'email' | 'phoneNumber'>;
```

Тип только с данными о доставке:

```
export type TDelivery = Pick<IOrderInfo, 'payment' | 'address'>;
```

Тип только с данными о наполнении корзины:

```
export type TOrderList = Pick<IOrderInfo, 'total' | 'items'>
```

Отработка клика мышки:

```
export interface IMouseEvent {
	onClick: (event: MouseEvent) => void;
}
```

Наполнение карточки:

```
export interface ICardDetails {
    category: HTMLElement;
    title: HTMLElement;
    image: HTMLImageElement;
    price: HTMLElement;
    description: HTMLElement;
    button: HTMLButtonElement;
    removeButton: HTMLButtonElement;
    index: HTMLElement;
}
```

Список категорий:

```
export enum CategoryList {
    SOFT = 'софт-скил',
	OTHER = 'другое',
    EXTRA = 'дополнительное',
	BUTTON = 'кнопка',
	HARD = 'хард-скил',
}
```

## Архитектура

В данном проекте для разделения слоев используется парадигма MVP, используются следующие слои:

1. Слой для работы с данными, который работает над изменением и хранением данных
2. Слой представления - отображает данные
3. Презентер (представитель) - объединяет слой представления и слой данных, поскольку знать они друг о друге не должны, но при этом работать в тандеме.

## Базовый код

### Класс API

Класс Api предназначен для работы с HTTP-запросами, предоставляя удобный интерфейс для выполнения GET и POST запросов.

#### Свойства класса:

```
readonly baseUrl: string; базовый URL, который используется в каждом запросе. Это свойство доступно только для чтения, что означает, что его значение нельзя изменить.
```

```
protected options: RequestInit; — объект конфигурации для запросов. Это свойство защищено, что позволяет использовать его только внутри класса и его потомков.
```

#### Конструктор:

```
constructor(baseUrl: string, options: RequestInit = {}) — создает объект класса Api. Он принимает два параметра:
baseUrl — базовый URL для всех запросов.
options — дополнительные параметры для настройки запросов. По умолчанию устанавливается заголовок 'Content-Type': 'application/json'.
```

#### Методы:

```
protected handleResponse(response: Response): Promise<object> - обработка ответа сервера
```

```

post(uri: string, data: object, method: ApiPostMethods = 'POST') - POST запрос к серверу, обрабатывается методом handleResponse
```

```

get(uri: string) - GET запрос к серверу, обрабатывается методом handleResponse
```

### Класс EventEmitter

Класс EventEmitter это брокер событий, связывает между собой отображение и данные. При помощи него можно работать с системой событий в проекте. Имплементируется интерфейсом IEvents.

#### Свойства класса:

```
_events: Map<EventName, Set<Subscriber>>; — карта, где ключами являются имена событий, а значениями — обработчки
```

#### Конструктор:

```
constructor() — инициализирует объект класса EventEmitter, создавая пустую карту _events для хранения подписок.
```

#### Методы:

```
on<T extends object>(eventName: EventName, callback: (event: T) => void) - установка обработчика на событие
```

```
off(eventName: EventName, callback: Subscriber) - снятие обработчика с события
```

```
emit<T extends object>(eventName: string, data?: T) - инициализация события с данными
```

```
onAll(callback: (event: EmitterEvent) => void) - слушать все события
```

```
offAll() - сброс всех обработчиков
```

```
trigger<T extends object>(eventName: string, context?: Partial<T>) -  коллбек триггер, генерирующий событие при вызове
```

### Класс Component
Класс Component<T> представляет собой абстрактный базовый класс для создания компонентов, работающих с DOM. Он предназначен для упрощения манипуляций с элементами DOM и предоставления базового функционала, который может быть расширен в дочерних классах.
#### Конструктор: 
```
constructor(container: HTMLElement): Инициализирует компонент с заданным корневым элементом container. Этот элемент будет использоваться как контейнер для всех операций с DOM в рамках компонента.
```

#### Методы:

```
toggleClass(element: HTMLElement, className: string, force?: boolean): Переключает наличие CSS-класса className у элемента element. Если передан параметр force, то класс будет добавлен или удален в зависимости от его значения (true для добавления, false для удаления).
```

```
setText(element: HTMLElement, value: unknown): Устанавливает текстовое содержимое элемента element в значение value.
```

```
setDisabled(element: HTMLElement, state: boolean): Изменяет статус блокировки элемента element. Если state равно true, элемент блокируется, если false — разблокируется.
```

```
setHidden(element: HTMLElement): Скрывает элемент element, устанавливая его стиль display в none.
```

```
setVisible(element: HTMLElement): Делает элемент element видимым, удаляя свойство display.
```

```
setImage(element: HTMLImageElement, src: string, alt?: string): Устанавливает источник изображения src и альтернативный текст alt для элемента изображения element.
```

```
render(data?: Partial<T>): HTMLElement: Обновляет данные компонента и возвращает корневой элемент container.
```

### Класс Model

Класс Model может быть использован как базовый класс для других моделей, которые требуют управления состоянием и событиями.

#### Конструктор:

```
data: Partial<T>: Объект, содержащий данные для инициализации модели. Используется Partial<T>, чтобы указать, что не все свойства типа T должны быть обязательными.
events: IEvents: Интерфейс или объект, который реализует функциональность для работы с событиями.
```

#### Методы:

```
emitChanges(event: string, payload?: object): Метод, который используется для генерации событий. Он принимает имя события и необязательный объект payload, который содержит данные, связанные с событием.
Внутри метода вызывается this.events.emit, что позволяет уведомлять другие части приложения о произошедших изменениях.
```

## Компоненты модели данных

### Класс ProductsData

Класс используется для управления коллекцией продуктов. Он предоставляет метод для установки списка товаров. Класс ProductsData производный от абстрактного класса Model, конструктор описан в нем. Используется интерфейс IProduct

#### Поля класса:

```
productsList: IProduct[];  - сборка карточек товаров
```

#### Методы класса:

loadProducts(product: IProduct[]): void - первоначальная установка товаров в коллекцию

### Класс BasketData

Управление товарами внутри корзины. В данном классе имеются методы для изменения состава корзины, а также получения итоговой суммы товаров и их количества
Класс BasketData производный от абстрактного класса Model, конструктор описан в нем. Используется тип IProduct

#### Поля класса:

```
productsList: IProduct[]; - карточки в корзине
total: number | null;
```

#### Методы класса:

```
addProduct(product: IProduct): void; - добавляем товар в корзину
deleteProduct(product: IProduct): void; - удаляем товар из корзины
updateTotalBasketSum(): number: - обновляем сумму заказа
finalPrice(): number; - подсчитываем сумму заказа
clearBasket(): void - очищаем корзину
```

### Класс OrderData

Полная сборка заказа с валидацией полей с которыми контактирует пользователь. Класс OrderData производный от абстрактного класса Model, конструктор описан в нем. Используется тип IOrderInfo

#### Поля класса:

```
items: IProduct[]; - список продуктов
total: number | null; - общая сумма
email: string; - личная почта
phone: string; - личный номер
payment: TPaymentProcess; - способ оплаты
address: string; - личный адрес
formError: Partial<Record<keyof IOrderInfo, string>>; - сбор ошибок
isValid: boolean; - флаг, указывающий, является ли форма валидной.
```

#### Методы класса:

validatePersonalInfo(): boolean - проверка заполнялись ли поля в форме ввода персональных данных
validateDelivery(): boolean - проверка, заполнялись ли поле в форме ввода адреса и выбран ли способ доставки. При отсутствии введенных значений появляется кастомная ошибка
clear(): void - очистка данных после успешного заказа

## Компоненты отображения

### Класс CardView

Отображение карточки товара на странице. Устанавливаюся наименования товаров, описание, фото, цена, категория. Ставим слушатели для обработки событий.

#### Поля класса:

```
protected cardElements: ICardDetails; - сборка элементов для карточки товара
```

#### Конструктор класса:

Создает и настраивает экземпляр класса Card. Параметры:

```
container: HTMLElement - контейнер, в котором находятся элементы карточки.
element: string - имя блоков для поиска элементов.
actions?: ICardActions - объект с действиями для управления событиями.

Конструктор находит и сохраняет элементы карточки в container на основе element. Привязывает событие click к кнопке добавления в корзину, если оно указано в actions. Также привязывает событие click к кнопке удаления из корзины для удаления элемента из DOM.
```

#### Методы класса:

```
set price(value: number | null) - стоиомость товара
set index(value: number) - определяем индекс товара
set id(value: string) - ставим id товара
пet id(value: string) - получаем id товара
set category(value: string) - устанавливаем категорию товара
set title(value: string) - ставим название товара
get title(value: string) - получаем название товара
set image(value: string) - ставим изображение товара
set description(value: string) - ставим описание товара
changeButtonStatus(product: IProduct) - меняем текст и работу кнопки в превью товара
```

### Класс ModalView

Создание модального окна. Обработка событий клавиатуры и кликов для закрытия окна. На вход в конструкторе используются элемент разметки и экземпляр класса EventEmitter.

#### Поля класса:

составные части модального окна

```
closeButton: HTMLButtonElement - кнопка для закрытия модального окна.
contentElement: HTMLElement - элемент для отображения содержимого модального окна
```

#### Конструктор класса:

Создает и настраивает экземпляр класса ModalView. Параметры:

```
container: HTMLElement - контейнер, в котором находятся элементы модального окна.
events: IEvents - объект для управления событиями.
```

Конструктор находит и сохраняет элементы кнопки закрытия и содержимого в container. Привязывает событие click к кнопке закрытия

#### Методы класса:

```
set content(value: HTMLElement) - заменяет текущее содержимое модального окна новым содержимым.
open(): void - открывает модальное окно, добавляя класс 'modal_active', и вызывает событие 'modal:open'.
close(): void - закрывает модальное окно, удаляя класс 'modal_active', очищая содержимое и вызывая событие 'modal:close'.
render(data: IModalData): HTMLElement - рендерит модальное окно с указанными данными, открывает его и возвращает контейнер.
clearContent(): void - очистка лдя закрытия
```

### Класс FormView

Управление формой и её состоянием. Использует элемент формы и объект для управления событиями.

#### Поля класса:

```
submit: HTMLButtonElement - кнопка для отправки формы.
error: HTMLElement - элемент для отображения ошибок в форме.
```

#### Конструктор класса:

constructor(protected container: HTMLFormElement, protected events: IEvents)
Конструктор находит и сохраняет элементы кнопки отправки и отображения ошибок в container. Привязывает событие input к элементам формы для обработки изменений и событие submit для предотвращения стандартной отправки формы и генерации пользовательского события.

#### Методы класса:

```
protected updateFieldValue(field: keyof T, value: string): void - обрабатывает изменения в полях формы, генерируя событие изменения с именем поля и его значением.
set valid(value: boolean) - управляет доступностью кнопки отправки формы в зависимости от валидности формы.
set errors(value: string) - отображает ошибки в форме.
render(state: Partial<T> & TFormState): HTMLElement - рендерит форму с указанным состоянием, обновляет элементы формы и возвращает контейнер.
```

### Класс PageView

Класс Page предназначен для управления элементами интерфейса страницы, такими как счетчик товаров в корзине, каталог товаров и состояние блокировки страницы.

#### Поля класса:

```
protected pageElements: IPageElements; - элементы главной страницы
```

#### Конструктор класса:

constructor(container: HTMLElement, events: IEvents) - инициализирует экземпляр класса PageView. Принимает контейнер страницы и объект для работы с событиями. Конструктор вызывает родительский конструктор View и инициализирует поля, используя вспомогательную функцию ensureElement, чтобы гарантировать наличие необходимых элементов DOM.

#### Методы класса:

```
set counter(value: number) - сеттер для обновления значения счетчика. Принимает числовое значение и обновляет текстовое содержимое элемента счетчика.
set catalog(items: HTMLElement[]) - сеттер для обновления каталога товаров. Принимает массив элементов и заменяет текущие дочерние элементы контейнера каталога на новые.
set locked(value: boolean) - сеттер для управления состоянием блокировки страницы. Добавляет или удаляет CSS-класс page__wrapper_locked в зависимости от переданного булевого значения, чтобы контролировать доступность
взаимодействия с контентом страницы.
```

#### Интерфейсы:

```
export interface IPage {
	counter: number;
	catalog: HTMLElement[];
	locked: boolean;
}

export interface IPageElements {
	counter: HTMLElement - элемент, отображающий количество товаров в корзине.
    catalog: HTMLElement - контейнер для элементов коллекции.
    wrapper: HTMLElement - основной контейнер страницы.
    basket: HTMLElement - элемент, представляющий корзину.
}
```

### Класс BasketView

Отображение модального окна с корзиной. На вход в конструкторе используются элемент разметки и экземпляр класса EventEmitter.

#### Поля класса:

```
list : HTMLElement - элемент для отображение товаров в корзине
price: HTMLElement - элекмент для отображения общей суммы заказа
button: HTMLButtonElement - элемент кнопки, используемой в корзине
```

#### Конструктор класса:

constructor( protected element: string, container: HTMLElement, protected events: IEvents)
Создает и настраивает экземпляр класса BasketView. Параметры - имя блоков для поиска элементов(element: string), элемент для корзины(container: HTMLElement) и объект для управления событиями (events: IEvents). Находит и сохраняет элементы кнопки, списка и общей стоимости в container на основе element.
Привязывает событие click к кнопке.

#### Методы:

```
products(): void - обновление списка товаров в коризне
basketSum(): number - сумма товаров
setButtonDisabled(state: boolean) - переключение статуса кнопки
```

### Класс DeliveryView

Отображение модального окна с выбором способа доставки и заполненеием поля личного адреса. Предоставляется выбор способа доставки, а также ввод адреса. Он наследуется от класса FormView, который предоставляет базовую функциональность для работы с формами и их состоянием.

#### Поля класса: элементы формы из разметки.

```
private deliveryElements: IDeliveryElements; - сборка элементов формы
```

#### Конструктор класса:

```
constructor(container: HTMLFormElement, events: IEvents)
Принимает контейнер формы и объект для работы с событиями.  Добавляются обработчики событий для каждого элемента - поля адреса и кнопок выбора вида оплаты.
```

#### Методы класса:

```
set payment(value: TPaymentProcess): void - установка метода оплаты
set address(value: string): void - заполнение адреса
```

#### Интерфейсы:

```
interface IDeliveryElements {
	addressField: HTMLInputElement - поле ввода адреса. Используется для ввода и изменения адреса доставки.
    cardButton: HTMLButtonElement - кнопка выбора онлайн-оплаты. Используется для переключения метода оплаты на "онлайн".
    cashButton: HTMLButtonElement - кнопка выбора оплаты наличными при получении. Используется для переключения метода оплаты на "при получении".
}
```

### Класс ContactsView

Предназначен для управления формой ввода контактной информации, такой как электронная почта и номер телефона.

#### Поля класса: элементы формы из разметки.

```
protected emailField: HTMLInputElement; - поле ввода для электронной почты.
protected phoneField: HTMLInputElement; - поле ввода для номера телефона.
```

#### Конструктор класса:

```
constructor(container: HTMLFormElement, events: IEvents)
Принимает контейнер формы и объект для работы с событиями.  Добавляются обработчики событий для каждого элемента - полей ввода персональной информации покуптеля.
```

#### Методы класса:

```
set phone(value: string): void - заполнение поля с номером
set email(value: string): void - заполнение поля с почтовым ящиком
```

### Класс SuccessView

Предназначен для отображения информации о завершении операции, с возможностью указания суммы, которая была списана

#### Поля класса: кнопка выхода из формы и информация о сумме покупки.

```
closeButton: HTMLButtonElement - кнопка закрытия
finalOrderInfo: HTMLElement - элемент, отображающий сообщение об успешной операции. Используется для вывода информации о списанной сумме синапсов
```

#### Конструктор класса

```
constructor(container: HTMLElement, element: string,  actions: IMouseEvent)
Параметры - имя блоков для поиска элементов(element: string), элемент для вставки(container: HTMLElement) и объект для управления событиями (actions: IMouseEvent).
```

#### Методы класса:

```
set finalSum(value: number): number - для отображения финальной суммы
```

## Презентер (связь слоя данных и слоя отображения)

Необходим для связи моделей данных и слоя отображения.
Работает следующим образом - происходит подписка на события (переход на след. шаг заказа, клик, нажатие на клавишу). При помощи экземпляра класса EventEmitter мы можем управлять отображением в условиях, когда модель данных работает над данными. Данные и отображение не знают о существовании друг друга, но работают вместе.
